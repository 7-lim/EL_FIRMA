{# templates/evenement/calendar.html.twig #}
{% extends 'baseFournisseur.html.twig' %}

{% block body %}
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">Calendrier des Événements</h1>
            <a href="{{ path('app_evenement_new') }}" class="btn btn-success">
                <i class="fas fa-plus me-2"></i>Créer un Nouvel Événement
            </a>
        </div>

        {# Calendar container with fixed height #}
        <div class="card shadow">
            <div class="card-body">
                <div id="calendar-holder" style="min-height: 70vh"></div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const calendarEl = document.getElementById('calendar-holder');
            
            const calendar = new FullCalendar.Calendar(calendarEl, {
                locale: 'fr',
                initialView: 'dayGridMonth',
                themeSystem: 'bootstrap5',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: 'Aujourd\'hui',
                    month: 'Mois',
                    week: 'Semaine',
                    day: 'Jour'
                },
                events: {
                    url: "{{ path('fc_load_events') }}",
                    method: 'POST',
                    failure: function() {
                        console.error('Erreur de chargement des événements');
                        calendarEl.innerHTML = '<div class="alert alert-danger">Erreur de chargement du calendrier</div>';
                    }
                },
                eventDidMount: function(info) {
                    new bootstrap.Popover(info.el, {
                        title: info.event.title,
                        content: `
                            <strong>Date début:</strong> ${info.event.start.toLocaleDateString('fr-FR')}<br>
                            <strong>Date fin:</strong> ${info.event.end.toLocaleDateString('fr-FR', {day: 'numeric', month: 'short', year: 'numeric'})}<br>
                            <strong>Lieu:</strong> ${info.event.extendedProps.lieu}<br>
                            <strong>Places:</strong> ${info.event.extendedProps.places}<br>
                            <strong>Prix:</strong> ${info.event.extendedProps.prix}€
                        `,
                        trigger: 'hover',
                        placement: 'auto',
                        html: true,
                        container: 'body'
                    });
                }
            });
    
            calendar.render();
        });
    </script>
{% endblock %}