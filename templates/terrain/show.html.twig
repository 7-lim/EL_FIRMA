{% extends 'base.html.twig' %}

{% block title %}Détails du Terrain{% endblock %}

{% block body %}
<style>
    .container {
        max-width: 900px;
        margin: auto;
    }
    .card {
        border-radius: 12px;
        transition: 0.3s ease-in-out;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    }
    .card:hover {
        transform: translateY(-3px);
        box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.15);
    }
    #map {
        height: 300px;
        width: 100%;
        border-radius: 10px;
        margin-top: 20px;
    }
    .weather-card {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        color: white;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        max-width: 300px;
        margin: 20px auto;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }
    .weather-card:hover {
        transform: scale(1.03);
    }
    .temp {
        font-size: 30px;
        font-weight: bold;
    }
    #weatherChart {
        height: 350px;
        width: 100%;
    }
</style>

<div class="container py-5">
    <!-- Page Title -->
    <h2 class="text-center mb-4">Détails du Terrain</h2>
    
    <!-- Terrain Details Card -->
    <div class="card shadow-lg">
        <div class="card-body text-center">
            <h3 class="card-title">{{ terrain.localisation|default('Localisation inconnue') }}</h3>
            <hr>
            <p>
                <strong>Superficie :</strong> {{ terrain.superficie|number_format(0, ',', ' ') }} m²<br>
                <strong>Latitude :</strong> {{ terrain.latitude|default('Non spécifiée') }}<br>
                <strong>Longitude :</strong> {{ terrain.longitude|default('Non spécifiée') }}
            </p>
        </div>
    </div>

    <!-- Map Section -->
    <div id="map"></div>

    <!-- Weather Card (Include from weather_card.html.twig) -->
    {% if weatherData is defined and weatherData.cod == 200 %}
        <div class="weather-card mt-4">
            {% include 'terrain/weather_card.html.twig' with {'weather': weatherData} %}
        </div>
    {% else %}
        <p class="text-center text-danger mt-4">Aucune donnée météo disponible pour ce terrain.</p>
    {% endif %}

    <!-- Weather Chart -->
    <div class="card shadow-lg mt-4">
        <div class="card-body">
            <h3 class="text-center">Analyse Météo</h3>
            <div id="weatherChart"></div>
        </div>
    </div>
</div>

<!-- Leaflet.js for Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Initialize the Map
        const map = L.map('map').setView([{{ terrain.latitude }}, {{ terrain.longitude }}], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        L.marker([{{ terrain.latitude }}, {{ terrain.longitude }}]).addTo(map)
            .bindPopup('<b>{{ terrain.localisation }}</b><br>Superficie: {{ terrain.superficie }} m²')
            .openPopup();

        // Load Google Charts and Draw Weather Data Chart
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable([
                ['Météo', 'Valeurs'],
                ['Température', {{ weatherData.main.temp }}],
                ['Ressentie', {{ weatherData.main.feels_like }}],
                ['Humidité', {{ weatherData.main.humidity }}],
                ['Pression', {{ weatherData.main.pressure }}],
                ['Vent', {{ weatherData.wind.speed }}]
            ]);

            var options = {
                title: 'Conditions météorologiques',
                legend: { position: 'bottom' },
                backgroundColor: 'transparent',
                chartArea: { width: '85%', height: '70%' }
            };

            var chart = new google.visualization.ColumnChart(document.getElementById('weatherChart'));
            chart.draw(data, options);
        }
    });
</script>
{% endblock %}
